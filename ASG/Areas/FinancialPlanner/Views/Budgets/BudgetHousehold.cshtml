@model ASG.Areas.FinancialPlanner.Models.BudgetHouseholdViewModel
@{
    ViewBag.Title = "BudgetHousehold";
}

@using Microsoft.AspNet.Identity
@{
    ViewBag.Title = "Index";
}
@{ var userid = User.Identity.GetUserId();

}
<!DOCTYPE html>
<html lang="en">
<head>
    <link href="~/Areas/FinancialPlanner/FP_css/jquery.dataTables.css" rel="stylesheet" />
</head>
<body>
    <div class="parallax-slider">
        <!-- Slider (Parallax Slider) -->
        <div id="da-slider" class="da-slider">
            <!-- Each slide should be enclosed inside "da-slide" class -->
            <div class="da-slide">
                <div class="slide-details">
                    <!-- Heading -->
                    <h2><span>Clean and Professional</span></h2>
                    <!-- Para -->
                    <p>When she reached the first hills of the Italic Mountains, she had a last view back on the skyline of her hometown Bookmarksgrove, the headline of Alphabet Village and the subline of her own road, the Line Lane.</p>
                    <!-- Read more link -->
                    <a href="#" class="da-link">Read more</a>
                    <!-- Image -->
                    <div class="da-img"><img src="" alt="image01" /></div>
                </div>
            </div>
            <div class="da-slide">
                <h2><span>40+ Pagest</span></h2>
                <p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p>
                <a href="#" class="da-link">Read more</a>
                <div class="da-img"><img src="" alt="image01" /></div>
            </div>
            <div class="da-slide">
                <h2><span>6 Colors</span></h2>
                <p>A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p>
                <a href="#" class="da-link">Read more</a>
                <div class="da-img"><img src="" alt="image01" /></div>
            </div>
            <div class="da-slide">
                <h2><span>Quality Control</span></h2>
                <p>Even the all-powerful Pointing has no control about the blind texts it is an almost unorthographic life One day however a small line of blind text by the name of Lorem Ipsum decided to leave for the far World of Grammar.</p>
                <a href="#" class="da-link">Read more</a>
                <div class="da-img"><img src="" alt="image01" /></div>
            </div>
            <nav class="da-arrows">
                <span class="da-arrows-prev"></span>
                <span class="da-arrows-next"></span>
            </nav>
        </div>
    </div>
    <br /><br /><br />
    <h6 style="padding-left:22px; color:#888"> Welcome  @Model.household.Users.FirstOrDefault(u => u.Id == userid).FullName</h6><br /><br />
    <div class="page-head">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <span style="color:#888; font-size:14px">Budget Portal</span><br />
                    <span style="color:#888; font-size:14px">Click image below to view your budget details</span><br /><br />
                </div>
            </div>
        </div>
    </div>
    <!-- Page Heading ends -->
    <!-- Page content starts -->
    <div class="content about-two">
        <div class="container">
            <div class="row">
                <div class="col-md-9">
                    @foreach (var budget in Model.budgets)
                    {
                        if (!budget.Expired)
                        {
                            <div class="col-md-3 col-sm-6  well" style="margin:0 20px 20px 0px; box-shadow: 3px 3px 0px 0px rgba(97,96,97,1);">
                                <!-- Staff #1 -->
                                <div class="staff">
                                    <!-- Picture -->
                                    <a href="@Url.Action("Details", "Budgets", new { id = budget.Id })">
                                        <div class="pic">
                                            <img src="~/Areas/FinancialPlanner/FP_Images/horizontal-1714232.png" alt="" class="img-responsive" />
                                        </div>
                                    </a>
                                    <!-- Details -->
                                    <div class="details">
                                        <!-- Name and designation -->
                                        <div class="desig pull-left">
                                            @if (budget.Name != null)
                                            {
                                                <span class="name" style="font-size:11px">
                                                    @budget.Name
                                                </span>
                                            }
                                            else
                                            {
                                                <span class="name" style="font-size:11px">
                                                    class="name">N/A
                                                </span>
                                            }

                                        </div>
                                        <!-- Social media details. Replace # with profile links -->
                                        <div class="asocial pull-right">
                                            <a href="#"><i class="fa fa-facebook"></i></a>
                                            <a href="#"><i class="fa fa-twitter"></i></a>
                                            <a href="#"><i class="fa fa-linkedin"></i></a>
                                        </div>
                                        <div class="clearfix"></div>
                                        <!-- Description -->
                                        @if (budget.Description != null)
                                        {
                                            <span class="adesc" style="font-size:12px">@budget.Description </span>
                                        }
                                        else
                                        {
                                            <span class="adesc" style="font-size:12px">
                                                N/A
                                            </span>
                                        }
                                    </div>
                                </div>
                            </div>
                        }
                    }
                    @if (!Model.budgets.Where(b => b.Expired == false).Any())
                    {
                        <div class="col-md-3 col-sm-6  well" style="margin:0 10px 0 10px; box-shadow: 10px 10px 5px #888888;">
                            <!-- Staff #1 -->
                            <div class="staff">
                                <!-- Picture -->
                                <a href="@Url.Action("BudgetsCreateModal","Budgets", new { id = userid })" data-toggle="modal" data-target="#myModal1">
                                    <div class="pic">
                                        <img src="~/Areas/FinancialPlanner/FP_Images/horizontal-1714232.png" alt="" class="img-responsive" />
                                    </div>
                                </a>
                                <!-- Details -->
                                <div class="details">
                                    <!-- Name and designation -->
                                    <div class="desig pull-left">
                                        <span class="name" style="font-size:11px">You don't have any current budgets</span><br />
                                    </div>
                                    <!-- Social media details. Replace # with profile links -->
                                    <div class="asocial pull-right">
                                        <a href="#"><i class="fa fa-facebook"></i></a>
                                        <a href="#"><i class="fa fa-twitter"></i></a>
                                        <a href="#"><i class="fa fa-linkedin"></i></a>
                                    </div>
                                    <div class="clearfix"></div>
                                    <!-- Description -->
                                    <p class="adesc" style="font-size:14px">Create a New Budget </p>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                <div class="col-md-3">
                    <div class="pull-right">
                        @if (Request.IsAuthenticated)
                        {
                            <input type="button" class="btn" style="color:white; background-color:#c5601f; width:250px; margin-bottom:7px" onclick="householdDetails()" value="My Household Details" /><br />
                            <a type="button" class="btn" style="color:white; background-color:#c5601f; width:250px; margin-bottom:7px" href="@Url.Action("Create", "FinancialAccounts")" data-toggle="modal" data-target="#myModalAccountCreate">Add Accounts</a><br />

                            <a type="button" class="btn" style="color:white; background-color:#c5601f;width:250px; margin-bottom:7px" href="@Url.Action("BudgetsCreateModal","Budgets", new { id = userid })" data-toggle="modal" data-target="#myModal1">Create a New Budget</a><br />
                            <a type="button" class="btn" style="color:white; background-color:#c5601f; width:250px; margin-bottom:7px" href="@Url.Action("CreateInvitationsModal","Invitations")" data-toggle="modal" data-target="#myModalInvite">Invite Others to Join</a><br />
                            <a type="button" class="btn" style="color:white; background-color:#c5601f; width:250px; margin-bottom:7px" href="@Url.Action("LeaveHousehold", "Households", new { id = Model.household.Id })" data-toggle="modal" data-target="#LeaveHousehold">Leave Household</a><br />
                            <a type="button" class="btn" style="color:white; background-color:#c5601f; width:250px; margin-bottom:7px" href="@Url.Action("Edit", "Households", new { id = Model.household.Id })" data-toggle="modal" data-target="#EditHousehold">Edit Household</a><br />
                            if (ViewBag.UserBudgets.Count != 0)
                            {
                                <a type="button" class="btn btn-success" style="color:white; width:200px;" href="@Url.Action("Index","Budgets", new { id = userid })">View My Budgets</a>
                            }
                        }
                    </div>
                </div>

              
            </div>
        </div>
        <br />
        <p style="padding-left:30px; padding-bottom:50px">
            @if (Request.IsAuthenticated)
            {
                <a href="@Url.Action("BudgetsCreateModal","Budgets", new { id = userid })" data-toggle="modal" data-target="#myModal1">Create a New Budget</a>
            }
        </p>
        <hr />
        <div class="matter">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="widget">
                            <div class="widget-head">
                                <div class="pull-left">Current Budgets</div>
                                <div class="widget-icons pull-right">
                                    <a href="#" class="wminimize"><i class="fa fa-chevron-up"></i></a>
                                    <a href="#" class="wclose"><i class="fa fa-times"></i></a>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                            <div class="widget-content">
                                <div class="padd statement">
                                    <div class="row">
                                        <table class="table" id="currentBudgets" style="table-layout:fixed">
                                            <tr>
                                                <th>
                                                    Budget Created By
                                                </th>
                                                <th>
                                                    @Html.DisplayNameFor(model => model.budget.Name)
                                                </th>
                                                <th>Budget Amount</th>
                                                <th>Budget Start Date</th>
                                                <th>Budget Duration Period</th>
                                                <th>Actions</th>
                                            </tr>
                                            <tbody>
                                                @foreach (var item in Model.budgets)
                                                    {
                                                        if (!item.Expired)
                                                        {
                                                        <tr>
                                                            <td>
                                                                @foreach (var user in ViewBag.BudgetCreator)
                                                                {
                                                                    if (user.Id == item.UserId)
                                                                    {
                                                                        @user.FullName;
                                                                    }
                                                                }
                                                            </td>
                                                            <td>
                                                                @Html.DisplayFor(modelItem => item.Description)
                                                            </td>
                                                            <td>
                                                                @Html.DisplayFor(modelItem => item.Amount)
                                                            </td>
                                                            <td>
                                                                @Html.DisplayFor(modelItem => item.BudgetStartDate)
                                                            </td>
                                                            <td>

                                                                @Html.DisplayFor(modelItem => item.BudgetDurationPeriod.NumberOfDays) Days  @*(@Html.DisplayFor(modelItem => item.BudgetStartDate)) -- @item.BudgetStartDate.AddDays(item.BudgetDurationPeriod.NumberOfDays))*@
                                                            </td>
                                                            <td>
                                                                <a data-toggle="modal" data-target="#EditBudget" href="@Url.Action("Edit","Budgets", new { id = item.Id })">Edit</a> |
                                                                @Html.ActionLink("Details", "Details", new { id = item.Id }) |
                                                                <a data-toggle="modal" data-target="#DeleteBudget" href="@Url.Action("Delete", "Budgets", new { id = item.Id })">Delete</a>
                                                            </td>
                                                        </tr>
                                                    }
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="matter">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="widget">
                            <div class="widget-head">
                                <div class="pull-left">Past Budgets</div>
                                <div class="widget-icons pull-right">
                                    <a href="#" class="wminimize"><i class="fa fa-chevron-down"></i></a>
                                    <a href="#" class="wclose"><i class="fa fa-times"></i></a>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                            <div class="widget-content" style="display:none">
                                <div class="padd statement">
                                    <div class="row">
                                        <table class="table" id="pastBudgets">
                                            <tr>
                                                <th>
                                                    Budget Created By
                                                </th>
                                                <th>
                                                    @Html.DisplayNameFor(model => model.budget.Name)
                                                </th>
                                                <th>Budget Amount</th>
                                                <th>Budget Start Date</th>
                                                <th>Budget Duration Period</th>
                                                <th>Actions</th>
                                            </tr>
                                            <tbody>
                                                @foreach (var item in Model.budgets)
                                                    {
                                                        if (item.Expired)
                                                        {
                                                        <tr>
                                                            <td>
                                                                @foreach (var user in ViewBag.BudgetCreator)
                                                                {
                                                                    if (user.Id == item.UserId)
                                                                    {
                                                                        @user.FullName;
                                                                    }
                                                                }
                                                            </td>
                                                            <td>
                                                                @Html.DisplayFor(modelItem => item.Description)
                                                            </td>
                                                            <td>
                                                                @Html.DisplayFor(modelItem => item.Amount)
                                                            </td>
                                                            <td>
                                                                @Html.DisplayFor(modelItem => item.BudgetStartDate)
                                                            </td>
                                                            <td>
                                                                @Html.DisplayFor(modelItem => item.BudgetDurationPeriod.NumberOfDays) Days  @*(@Html.DisplayFor(modelItem => item.BudgetStartDate)) -- @item.BudgetStartDate.AddDays(item.BudgetDurationPeriod.NumberOfDays))*@
                                                            </td>
                                                            <td>
                                                                Expired
                                                            </td>
                                                        </tr>
                                                    }
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="matter">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="widget" style="margin-bottom:80px">
                            <div class="widget-head">
                                <div class="pull-left">Household Details</div>
                                <div class="widget-icons pull-right">
                                    <a href="#" class="wminimize"><i class="fa fa-chevron-down"></i></a>
                                    <a href="#" class="wclose"><i class="fa fa-times"></i></a>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                            <div class="widget-content" id="householdDetailsWidget" style="display:none">
                                <div class="padd statement">
                                    <div class="row">
                                        <div id="householdDetails">
                                            @*<h2>Household Details</h2>*@
                                            <hr />
                                            <br /><br />
                                            <div class="container">
                                                @{ var temporaryaccountmessage = TempData["NotYourAccountmessage"];}
                                                @temporaryaccountmessage
                                                @{ var accountmessage = TempData["accountmessage"];}
                                                @accountmessage
                                                @if (accountmessage == null)
                                                {
                                                    var budgetmessage = TempData["budgetmessage"];
                                                    @budgetmessage
                                                }
                                                <div class="row">
                                                    <div class="col-md-7">
                                                        <div class="table-responsive well" style="border:none; box-shadow: 3px 3px 0px 0px rgba(97,96,97,1);">
                                                            <br /><br />
                                                            <table class="table table-striped table-hover table-responsive" id="example">
                                                                <thead>
                                                                    <tr>
                                                                        <th></th>
                                                                        <th>Members</th>
                                                                        <th>Accounts</th>
                                                                        <th>Remove</th>
                                                                        <th>Budgets</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>

                                                                    @foreach (var member in Model.household.Users)
                                                                    {
                                                                        <tr>
                                                                            <td><img src="~/Areas/FinancialPlanner/FP_Images/avatar-294479.png" style="height:30px" /><span>&nbsp;&nbsp;&nbsp;</span></td>
                                                                            @*<td><img src="~/img/avatar-294479.png" style="height:30px" /><span>&nbsp;&nbsp;&nbsp;</span></td>*@
                                                                            <td>@member.FullName</td>
                                                                            <td>
                                                                                @foreach (var account in Model.household.Accounts)
                                                                                {
                                                                                    if (account.AccountHolderUserId == member.Id)
                                                                                    {
                                                                                        if (userid == account.AccountHolderUserId)
                                                                                        {
                                                                                            <a href="@Url.Action("Details", "FinancialAccounts", new { id = account.Id })">
                                                                                                @account.Name<br /><br />
                                                                                            </a>
                                                                                        }
                                                                                    }
                                                                                }
                                                                            </td>
                                                                            <td>
                                                                                @foreach (var account in Model.household.Accounts)
                                                                                {
                                                                                    if (account.AccountHolderUserId == member.Id)
                                                                                    {
                                                                                        if (userid == account.AccountHolderUserId)
                                                                                        {
                                                                                            <a href="@Url.Action("Delete", "FinancialAccounts", new { id = account.Id })" data-toggle="modal" data-target="#DeleteAccount"><span class="fa fa-trash-o"></span></a><br /><br />
                                                                                        }
                                                                                    }
                                                                                }

                                                                            </td>
                                                                            <td>
                                                                                @foreach (var budget in Model.budgets)
                                                                                {
                                                                                    if (budget.UserId == member.Id)
                                                                                    {
                                                                                        if (!budget.Expired)
                                                                                        {
                                                                                            var budgetId = budget.Id;
                                                                                            <a href="@Url.Action("Details","Budgets", new { id = budgetId})">
                                                                                                @budget.Name<br /><br />
                                                                                            </a>
                                                                                        }
                                                                                    }
                                                                                }
                                                                            </td>
                                                                        </tr>
                                                                    }
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                        <br />
                                                        <br />
                                                    </div>
                                                    <div class="col-sm-5" style="margin-left:auto; margin-right:auto; text-align:center">
                                                        @*<img src="~/img/connections-2099068.png" style="height:240px; margin-top:50px" />*@
                                                        <img src="~/Areas/FinancialPlanner/FP_Images/connections-2099068.png" style="height:240px; margin-top:5px" />
                                                    </div>
                                                </div>
                                                <br /><br />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <br /><br /><hr />
    </div>
    <div id="myModalInvite" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>
    <div id="myModalAccountCreate" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>
    <div id="EditHousehold" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>
    <div id="LeaveHousehold" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>
    <div id="AccountDetails" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>
    <div id="DeleteAccount" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>
    <div id="EditBudget" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>
    <div id="DeleteBudget" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>
    <br /><br />
    <br /><br /><br />
    @section scripts {
        <script src="~/Areas/FinancialPlanner/FP_js/jquery.dataTables.min.js"></script> Data tables
        <script>
            function householdDetails() {
                var element = document.getElementById('householdDetailsWidget');
                element.style.display = "block";
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        </script>
        <script>
            $(document).ready(function () {
                $('#example').dataTable();
            });
        </script>
        <script>
            function pastBudgets() {
                debugger;
                document.getElementById('pastBudgets').style.display = "block";
                document.getElementById('currentBudgets').style.display = "none";
            }

        </script>
        <script>
            function currentBudgets() {
                debugger;
                document.getElementById('pastBudgets').style.display = "none";
                document.getElementById('currentBudgets').style.display = "block";
            }

            var createABudget = function() {
                debugger;
                var form = $("#CreateBudgets").serialize();
                $.ajax({
                    type: "POST",
                    url: "/FinancialPlanner/Budgets/BudgetsCreate",
                    data: $("#CreateBudgets").serialize(),
                    success: function (data) {
                        debugger;
                        if (!data.success) {
                            document.getElementById('budgetCreationErrors').innerHTML = data.ex.join('<br />');
                        }
                        else {
                            $('#CreateABudget').modal('toggle');
                            location.reload();
                            //$('#FPResetPasswordConfirmation').modal('toggle');
                        }
                    }
                });
            }
        
        </script>
    }
    <br /><br>
</body>
</html>